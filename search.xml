<?xml version="1.0" encoding="utf-8"?>
<search> 
  
  
    
    <entry>
      <title>基于 Raspberry Pi+OpenCV+Arduino 的智能小车</title>
      <link href="/2022/03/03/%E5%9F%BA%E4%BA%8E%20Raspberry%20Pi+OpenCV+Arduino%20%E7%9A%84%E6%99%BA%E8%83%BD%E5%B0%8F%E8%BD%A6/"/>
      <url>/2022/03/03/%E5%9F%BA%E4%BA%8E%20Raspberry%20Pi+OpenCV+Arduino%20%E7%9A%84%E6%99%BA%E8%83%BD%E5%B0%8F%E8%BD%A6/</url>
      
        <content type="html"><![CDATA[<p>本项目基于上位机 Raspberry Pi 和下位机 Arduino 相互通信的环境，利用SSH 远程登录，<br>结合摄像头 OpenCV 和 Python 进行实时图像的传输并判别交通信号的箭头，计算左右两侧的<br>PWM 值实现直线行驶，利用超声波模块检测小车前方障碍物距离，并设计避障算法。</p><h2 id="设计方法"><a href="#设计方法" class="headerlink" title="设计方法"></a>设计方法</h2><pre class=" language-bash"><code class="language-bash">    树莓派有两个控制板块，Arduino作为下位机，通过超声波模块检测前方一定距离内是否有箭头标志阻挡前进的路线，    通过电机驱动模块PWM方式控制左右两侧的轮子（左边两个轮子相同速度信号，右边两个轮子相同速度信号），    通过左右车轮的速度差来达到转弯的效果。    树莓派作为上位机，通过摄像头判别交通箭头的信号。判别箭头是通过判断识别到的轮廓（箭头轮廓）的重心和最小外接矩形的重心两者的位置，    箭头的朝向跟箭头重心的位置直接关联，所以可以根据两个重心的位置关系来判断箭头是左箭头还是右箭头。    关于颜色的识别，将RGB颜色转化位HSV空间的颜色，判断图片中的颜色是否在绿色或者红色的色域中，在色域中则说明是对应的颜色。</code></pre><pre><code>!(source/image/cv.png)</code></pre><h2 id="制作方案"><a href="#制作方案" class="headerlink" title="制作方案"></a>制作方案</h2><h3 id="环境的安装"><a href="#环境的安装" class="headerlink" title="环境的安装"></a>环境的安装</h3><p>主要涉及关于树莓派和OpenCV的安装<br>·1 树莓派安装（便于可视化最好配置一台显示屏）<br>    1.1 下载系统镜像（之前写过关于<a href="https://blog.csdn.net/qq_43451257/article/details/105060324?spm=1001.2014.3001.5502">Ubuntu16.04下Git的安装</a>）,此处使用的是Raspbian的镜像（自带桌面和一些软件）<br>    1.2 格式化SD卡，将镜像写入，完成系统的安装<br>    1.3 开启SSH<br>        首先在根目录下新建SSH文件，用于远程登录，然后就把SD卡插到树莓派上</p><p>·2 OpenCV安装</p><pre class=" language-bash"><code class="language-bash">$ </code></pre><h3 id="硬件的连接"><a href="#硬件的连接" class="headerlink" title="硬件的连接"></a>硬件的连接</h3><p><strong>主要器材：</strong><br>锂电池：给arduino和电机驱动模块供电；<br>降压模块：用于降压保护arduino和电机，并可以稳定电压；<br>电机驱动模块：给电机供电，左侧两个电机的正极同时连接电机驱动模块上的一个out3，负极连接到out4，右侧连接out1、out2；<br>超声波模块：直接接在arduino板块上，由arduino供电并且arduino读取返回的信号值。</p><p>Step1. 将树莓派与Arduino通过USB线建立连接。<br>Step2. 在树莓派终端输入ls &#x2F;dev&#x2F;tty*查看两者连接端口的名字，若是出现ttyACM0则二者成功建立通信。<br>Step3. 编写树莓派与Arduino之间通信的代码</p><pre><code>树莓派端：</code></pre><pre class=" language-bash"><code class="language-bash"><span class="token function">import</span> serial    ser <span class="token operator">=</span> serial.Serial<span class="token punctuation">(</span><span class="token string">'/dev/ttyACM0'</span>, 9600,timeout<span class="token operator">=</span>1<span class="token punctuation">)</span><span class="token punctuation">;</span> try:  <span class="token keyword">while</span> 1:    ser.write<span class="token punctuation">(</span><span class="token string">'s'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment" spellcheck="true"># 向端口写入一个字符串</span>    response <span class="token operator">=</span> ser.readall<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment" spellcheck="true"># 读取</span>    print response<span class="token punctuation">;</span>except:  ser.close<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><pre><code>Arduino端：</code></pre><pre class=" language-bash"><code class="language-bash">void setup<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&amp;</span><span class="token comment" spellcheck="true">#123;</span>  Serial.begin<span class="token punctuation">(</span>9600<span class="token punctuation">)</span><span class="token punctuation">;</span> // 9600 bps<span class="token operator">&amp;</span><span class="token comment" spellcheck="true">#125;</span>void loop<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">&amp;</span><span class="token comment" spellcheck="true">#123;</span>  <span class="token keyword">if</span> <span class="token punctuation">(</span> Serial.available<span class="token punctuation">(</span><span class="token punctuation">))</span>    <span class="token operator">&amp;</span><span class="token comment" spellcheck="true">#123;</span>      if<span class="token punctuation">(</span><span class="token string">'s'</span> <span class="token operator">==</span> Serial.read<span class="token punctuation">(</span><span class="token punctuation">))</span>        Serial.println<span class="token punctuation">(</span><span class="token string">"Hello Raspberry,I am Arduino."</span><span class="token punctuation">)</span><span class="token punctuation">;</span>     <span class="token operator">&amp;</span><span class="token comment" spellcheck="true">#125;</span><span class="token operator">&amp;</span><span class="token comment" spellcheck="true">#125;   </span></code></pre><p>More info: <a href="https://hexo.io/docs/writing.html">硬件连接图</a></p><h3 id="图像处理"><a href="#图像处理" class="headerlink" title="图像处理"></a>图像处理</h3><p>RGB模型：<br>HSV模型：色调（H:hue），饱和度（S:saturation），亮度（V:value）</p><p>So, 为什么要采用HSV空间的色域</p><p>Step1. 获得红色掩膜（进行按位或运算1|1&#x3D;1，1|0&#x3D;0，0|1&#x3D;0，0|0&#x3D;0）<br>       获得绿色掩膜<br>Step2. 中值滤波处理（平滑图像，滤去噪声,保护图像的边缘）<br>Step3. 寻找轮廓并计算重心 cv2.findContours()</p><h4 id="上位机代码"><a href="#上位机代码" class="headerlink" title="上位机代码"></a>上位机代码</h4><pre class=" language-bash"><code class="language-bash"></code></pre><h4 id="下位机代码"><a href="#下位机代码" class="headerlink" title="下位机代码"></a>下位机代码</h4><pre class=" language-bash"><code class="language-bash">上位机</code></pre>]]></content>
      
      
      
    </entry>
    
    
  
  
</search>
